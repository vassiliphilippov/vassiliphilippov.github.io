<!doctype html><html lang=en><meta charset=UTF-8><meta content="width=device-width,initial-scale=1.0" name=viewport><link href="style.css?v=110" rel=stylesheet><title>Search Â· Glite Dictionary</title><body><div class=container><header><p class=small><a href=index.html>Home</a> | <a href=search.html>Search</a> | <a href=random.html>Random</a><h1>Search</h1></header><main><input placeholder="Loading search index..." class=search disabled id=q type=search><ul class=results hidden id=results></ul><div hidden id=history-section><h3 style=margin-top:1.5rem>Search History</h3><ul class=results id=history></ul></div></main><script id=search-config type=application/json>{"index":"search_index_v110_20251115T143946Z.jsonl","index_js":"search_index_v110_20251115T143946Z.js"}</script><style>ul.results{border:1px solid #eaeaea;border-radius:6px;margin-top:8px;padding:0;list-style:none}ul.results li{cursor:pointer;border-bottom:1px solid #f1f5f9;justify-content:space-between;padding:10px 12px;display:flex}ul.results li:last-child{border-bottom:none}ul.results li.active{background:#f0f6ff;outline:1px solid #c8e1ff}.result-main{flex-direction:column;gap:2px;display:flex}.result-head{font-size:1.05rem;font-weight:600;line-height:1.15}.result-sub{color:#6b7280;font-size:.95rem;line-height:1.2}.result-count{color:#6b7280;white-space:nowrap;margin-left:12px;padding-top:2px;font-size:.9rem}</style><script>(function(){var INDEX_HREF=`search_index.jsonl`;try{var cfg=document.getElementById(`search-config`);if(cfg&&cfg.textContent){var obj=JSON.parse(cfg.textContent);obj&&typeof obj.index==`string`&&obj.index.length>0&&(INDEX_HREF=obj.index),obj&&typeof obj.index_js==`string`&&obj.index_js.length>0&&(window.__INDEX_JS__=obj.index_js)}}catch{}!window.__INDEX_JS__&&typeof INDEX_HREF==`string`&&/\.jsonl$/i.test(INDEX_HREF)&&(window.__INDEX_JS__=INDEX_HREF.replace(/\.jsonl$/i,`.js`));let input=document.getElementById(`q`),list=document.getElementById(`results`),historySection=document.getElementById(`history-section`),historyList=document.getElementById(`history`),INDEX=[],maxItems=80,ACTIVE=-1,PERF={loadStart:performance.now(),loadEnd:0,indexSize:0,firstSearchStart:0,firstSearchEnd:0},HISTORY_KEY=`dictv3_search_history`,MAX_HISTORY=10;function getHistory(){try{let raw=localStorage.getItem(HISTORY_KEY);if(raw)return JSON.parse(raw)}catch{}return[]}function saveToHistory(item){try{let history=getHistory();history=history.filter(h=>h.h!==item.h),history.unshift(item),history=history.slice(0,10),localStorage.setItem(HISTORY_KEY,JSON.stringify(history))}catch{}}function renderHistory(){let history=getHistory();if(history.length===0){historySection.hidden=!0;return}historyList.innerHTML=``;for(let it of history){let li=document.createElement(`li`),main=document.createElement(`div`);main.className=`result-main`;let head=document.createElement(`span`);head.className=`result-head`,head.textContent=it.h;let sub=document.createElement(`span`);sub.className=`result-sub`;
// Reconstruct POS display from p array (also works with history items)
let subText=it.p_display||posSummary(it.p||[]);subText&&(sub.textContent=subText),main.appendChild(head),subText&&main.appendChild(sub);let count=document.createElement(`span`);count.className=`result-count`;let m=Number(it.m||0);m>1&&(count.textContent=`${m} meanings`),li.appendChild(main),m>1&&li.appendChild(count),li.addEventListener(`click`,()=>{window.location.href=it.u}),historyList.appendChild(li)}historySection.hidden=!1}function normalize(text){return(text||``).toLowerCase()}
/**
* Check if an index item is an inflected form (e.g., "cats" is inflected from "cat").
* OPTIMIZATION: Uses precomputed is_inflected flag from Python to avoid normalization.
*/
function isInflectedForm(item){
// Use precomputed value if available (faster)
if(item.is_inflected!==void 0&&item.is_inflected!==null)return item.is_inflected;
// Fallback for backwards compatibility (should not happen with new index)
if(!item.b)return!1;let normalizedSurfaceForm=normalize(item.h);return normalize(item.b)!==normalizedSurfaceForm}
/**
* Check if we should hide an inflected form from search results.
* We hide inflections when their base form is PRESENT in the results,
* UNLESS the user is explicitly searching for that exact inflection.
* 
* @param {object} item - The search index item to check
* @param {string} query - The normalized search query
* @param {Set<string>} baseFormsInResults - Set of base forms present in results
*/
function shouldHideInflection(item,query,baseFormsInResults){if(!isInflectedForm(item)||normalize(item.h)===normalize(query))return!1;
// Hide inflection if its base form is present in the search results
let normalizedBaseForm=normalize(item.b);return baseFormsInResults.has(normalizedBaseForm)}
/**
* Calculate a search relevance score for an item.
* Higher scores appear first in results.
*/
function calculateRelevanceScore(item,query){let normalizedSurfaceForm=normalize(item.h),normalizedQuery=normalize(query);
// Exact match: highest priority
if(normalizedSurfaceForm===normalizedQuery)return 300;
// Starts with query: high priority
// (but rank inflections lower than base forms)
if(normalizedSurfaceForm.startsWith(normalizedQuery))return isInflectedForm(item)?150:200;
// Contains query: lower priority, penalize by position
let matchPosition=normalizedSurfaceForm.indexOf(normalizedQuery);
// No match
return matchPosition===-1?-1:Math.max(1,100-matchPosition)}
/**
* Find and rank matching items for the search query.
*/
function suggest(query){
// Track first search performance
PERF.firstSearchStart===0&&(PERF.firstSearchStart=performance.now());let trimmedQuery=query.trim();
// Check for concept_id search (ct: prefix)
if(trimmedQuery.startsWith(`ct:`)){let conceptId=trimmedQuery.substring(3).trim();if(!conceptId)return[];let matches=[];for(let item of INDEX)item.c&&item.c.includes(conceptId)&&matches.push(item);return matches.slice(0,80)}
// Check for cluster_id search (cl: prefix)
if(trimmedQuery.startsWith(`cl:`)){let clusterId=trimmedQuery.substring(3).trim();if(!clusterId)return[];let matches=[];for(let item of INDEX)item.cl&&item.cl.includes(clusterId)&&matches.push(item);return matches.slice(0,80)}let normalizedQuery=normalize(trimmedQuery);if(!normalizedQuery)return[];
// PASS 1: Collect all matching items (before inflection filtering)
let scoredMatches=[];for(let item of INDEX){let relevanceScore=calculateRelevanceScore(item,normalizedQuery);relevanceScore>=0&&scoredMatches.push([relevanceScore,item])}
// Build set of all base forms (headwords) present in the initial results
// This is used to filter out inflections when their base form is available
let baseFormsInResults=/* @__PURE__ */ new Set;for(let[score,item]of scoredMatches){let normalizedHeadword=normalize(item.h);baseFormsInResults.add(normalizedHeadword)}
// PASS 2: Filter out inflections whose base forms are in the results
// (e.g., hide "cats" if "cat" is present, unless user searched for "cats" exactly)
let filteredMatches=[];for(let[score,item]of scoredMatches)shouldHideInflection(item,normalizedQuery,baseFormsInResults)||filteredMatches.push([score,item]);
// Sort filtered results by score (descending), then by frequency (descending), then alphabetically
filteredMatches.sort((a,b)=>{
// First: relevance score (higher is better)
if(b[0]!==a[0])return b[0]-a[0];
// Second: frequency (higher is better) - use pre-parsed numeric value
let freqA=a[1].f_num||0,freqB=b[1].f_num||0;
// Third: alphabetically
return freqB===freqA?a[1].h.localeCompare(b[1].h):freqB-freqA});
// Return top results
let results=filteredMatches.slice(0,80).map(match=>match[1]);
// Track first search completion
if(PERF.firstSearchStart>0&&PERF.firstSearchEnd===0){PERF.firstSearchEnd=performance.now();let searchTime=PERF.firstSearchEnd-PERF.firstSearchStart;console.log(`[Search Performance] First search completed in ${searchTime.toFixed(2)}ms`)}return results}
/**
* Reconstruct frequency display string from numeric value.
* Reduces index size by ~3-5% by not storing redundant string.
*/
function formatFrequency(f_num){return!f_num||typeof f_num!=`number`?null:f_num+`/m`}
/**
* Get difficulty color from numeric difficulty score.
* Reduces index size by not storing redundant hex colors.
*/
function getDifficultyColor(difficulty){return typeof difficulty==`number`?difficulty>=7?`#ef4444`:difficulty>=4?`#f59e0b`:`#22c55e`:`#22c55e`}let POS_MAP={N:`noun`,NOUN:`noun`,PROPN:`proper noun`,PROPER_NOUN:`proper noun`,ADJ:`adjective`,ADJECTIVE:`adjective`,ADV:`adverb`,ADVERB:`adverb`,V:`verb`,VERB:`verb`,AUX:`auxiliary verb`,PHRASAL_VERB:`phrasal verb`,PRON:`pronoun`,PRONOUN:`pronoun`,ADP:`preposition`,PREP:`preposition`,PREPOSITION:`preposition`,CONJ:`conjunction`,CCONJ:`conjunction`,SCONJ:`conjunction`,PART:`particle`,DET:`determiner`,DETERMINER:`determiner`,NUM:`numeral`,NUMERAL:`numeral`,INTJ:`interjection`,INTERJECTION:`interjection`};function friendlyPOS(pos){let t=(pos||``).trim().toUpperCase();return POS_MAP[t]||t.toLowerCase().replace(/_/g,` `)}function posSummary(posList){return!posList||!posList.length?``:Array.from(new Set(posList.map(friendlyPOS))).join(` â€¢ `)}function render(items){if(list.innerHTML=``,!items.length){list.hidden=!0,ACTIVE=-1;return}for(let i=0;i<items.length;i++){let it=items[i],li=document.createElement(`li`);li.dataset.index=String(i);let main=document.createElement(`div`);main.className=`result-main`;let head=document.createElement(`span`);head.className=`result-head`,head.textContent=it.h;let sub=document.createElement(`span`);sub.className=`result-sub`;
// Reconstruct POS display from p array (or use cached p_display if present)
let subText=it.p_display||posSummary(it.p||[]);subText&&(sub.textContent=subText),main.appendChild(head),subText&&main.appendChild(sub);let right=document.createElement(`span`);right.className=`result-count`;let m=Number(it.m||0);if(m>1)right.textContent=`${m} meanings`;else if(typeof it.d==`number`||typeof it.f_num==`number`){let container=document.createElement(`div`);
// Difficulty pill
if(container.className=`diff-freq-container`,typeof it.d==`number`){let diffPill=document.createElement(`span`);diffPill.className=`diff-pill`;
// Reconstruct color from difficulty (or use cached d_color if present)
let color=it.d_color||getDifficultyColor(it.d);diffPill.style.setProperty(`--diff-color`,color),diffPill.textContent=it.d.toFixed(1),container.appendChild(diffPill)}
// Frequency badge
if(typeof it.f_num==`number`){let freqBadge=document.createElement(`span`);freqBadge.className=`freq-badge`;
// Reconstruct frequency string from f_num (or use cached f if present)
let freqText=it.f||formatFrequency(it.f_num);freqText&&(freqBadge.textContent=freqText,container.appendChild(freqBadge))}right.textContent=``,right.appendChild(container)}li.appendChild(main),(right.textContent||right.children.length)&&li.appendChild(right),li.addEventListener(`click`,()=>{saveToHistory(it),window.location.href=it.u}),li.addEventListener(`mousemove`,()=>setActive(i)),list.appendChild(li)}list.hidden=!1,ACTIVE=-1}function setActive(i){let children=list.children;for(let j=0;j<children.length;j++)children[j].classList.toggle(`active`,j===i);ACTIVE=i}function openActiveOrFirst(){let items=Array.from(list.children);if(!items.length)return;let i=ACTIVE>=0?ACTIVE:0,idx=Number(items[i].dataset.index||0),it=CURRENT[idx];it&&(saveToHistory(it),window.location.href=it.u)}let CURRENT=[];input.addEventListener(`input`,()=>{let q=input.value;CURRENT=suggest(q),render(CURRENT),q.trim().length===0?renderHistory():historySection.hidden=!0}),input.addEventListener(`keydown`,ev=>{if(ev.key===`ArrowDown`){if(ev.preventDefault(),list.hidden)return;let n=CURRENT.length;if(!n)return;setActive(ACTIVE+1+0>=n?0:ACTIVE+1)}else if(ev.key===`ArrowUp`){if(ev.preventDefault(),list.hidden)return;let n=CURRENT.length;if(!n)return;setActive((ACTIVE-1+n)%n)}else ev.key===`Enter`&&(list.hidden||(ev.preventDefault(),openActiveOrFirst()))});async function loadIndex(){if(Array.isArray(window.SEARCH_INDEX))return window.SEARCH_INDEX;
// Prefer external NDJSON file
try{let res=await fetch(INDEX_HREF,{cache:`no-store`});if(res.ok){let lines=(await res.text()).split(/\r?\n/),arr=[];for(let line of lines){let t=line.trim();if(t.length!==0)try{arr.push(JSON.parse(t))}catch{}}return arr}}catch{}
// Fallback: embedded script for file:// usage
try{
// If a JS index is available, load it first
if(window.__INDEX_JS__&&(await new Promise(resolve=>{var s=document.createElement(`script`);s.src=window.__INDEX_JS__,s.onload=resolve,s.onerror=resolve,document.head.appendChild(s)}),Array.isArray(window.SEARCH_INDEX)))return window.SEARCH_INDEX;let embedded=document.getElementById(`embedded-index`);if(embedded&&embedded.textContent){
// Support either JSON array or NDJSON lines
let trimmed=embedded.textContent.trim();if(trimmed.startsWith(`[`))return JSON.parse(trimmed);let lines=trimmed.split(/\r?\n/),arr=[];for(let line of lines){let t=line.trim();if(t.length!==0)try{arr.push(JSON.parse(t))}catch{}}return arr}}catch{}return[]}
// Handle back button navigation: clear search and refocus
loadIndex().then(arr=>{if(Array.isArray(arr)){PERF.loadEnd=performance.now(),PERF.indexSize=arr.length,INDEX=arr;
// Log loading performance
let loadTime=PERF.loadEnd-PERF.loadStart,indexSizeKB=`N/A`;try{indexSizeKB=(JSON.stringify(arr).length/1024).toFixed(2)}catch{}
// Check which precomputed fields are present
let sampleRecord=arr.length>0?arr[0]:{},hasPrecomputed={f_num:`f_num`in sampleRecord,is_inflected:`is_inflected`in sampleRecord},precomputedCount=Object.values(hasPrecomputed).filter(Boolean).length;console.log(`â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`),console.log(`ðŸ“Š SEARCH INDEX LOADING PERFORMANCE`),console.log(`â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`),console.log(`â±ï¸  Load time: ${loadTime.toFixed(2)}ms`),console.log(`ðŸ“¦ Index size: ${PERF.indexSize.toLocaleString()} records`),console.log(`ðŸ’¾ Data size: ${indexSizeKB} KB`),console.log(`âš¡ Records/ms: ${(PERF.indexSize/loadTime).toFixed(2)}`),console.log(`ðŸš€ Precomputed fields: ${precomputedCount}/2 (f_num, is_inflected)`),console.log(`ðŸ“‰ Size optimized: removed f, p_display, d_color (~5% savings)`),console.log(`â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`),input.disabled=!1,input.placeholder=`Search surface formsâ€¦ (e.g., ran, runners, take off)`,input.focus();let val=(input.value||``).trim();val.length>0?(CURRENT=suggest(val),render(CURRENT)):renderHistory()}}),window.addEventListener(`pageshow`,function(event){
// event.persisted is true when page is loaded from bfcache (back/forward cache)
event.persisted&&(input.value=``,CURRENT=[],render(CURRENT),renderHistory(),input.disabled||input.focus())})})();</script></div>